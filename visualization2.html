<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Visualização 2</title>
		<script type = "text/javascript" src="d3/d3.v3.min.js"></script>
		<style>
		.legend{
			display: inline-grid;
			border-style: double;
		}
		.square {
			position: relative;
		  height: 10px;
  		width: 10px;
		}
		#negra{
			background-color: "#330000";
		}
		#parda{
			background-color: "#cc9966";
		}
		#branca{
			background-color: "#ffcccc";
		}
		#amarela{
			background-color: "#ffff99";
		}
		#indigena{
			background-color: "#cc0000";
		}
			.axis path,
			.axis line {
			fill: none;
			stroke: grey;
			shape-rendering: crispEdges;
			}
			.axis text {
			font-family: sans-serif;
			font-size: 11px;
			fill: olive;
			}

			circle {
				-moz-transition: all 0.3s;
				-o-transition: all 0.3s;
				-webkit-transition: all 0.3s;
				transition: all 0.3s;
			}
			circle:hover{
				fill:blue;
				stroke: blue;
				stroke-width: 5;
			}
		</style>
		<script>


			function drawSkin(){

				//largura e altura
				var w = 1700;
				var h = 400;

				//padding
				var padding = 90;

				//criando o elemento svg
				var chart = d3.select(".chart")
					.attr("width", w)
					.attr("height", h)
					.attr("font-family", "sans-serif")
					.attr("font-size", "11px")

				//formatando eixos como porcentagem
				var formatAsPercentage = d3.format(".1%");


					//seleciona o ano e gera os circulos
					d3.selectAll("#year")
					.on("click", function() {
						//Do something mundane and annoying on click
						//alert($(this).html());
						chart.selectAll(".axis").remove();
						d3.json($(this).html() + ".json", function(error,data) {
							if (error) { //If error is not null, something went wrong.
								console.log(error); //Log the error.
							}
							else { //If no error, the file loaded correctly. Yay!
								//console.log(data); //Log the data.
								dataset = data;

								//define escala do raio
								var rScale = d3.scale.linear()
									.domain([d3.min(data, function(d) { return d.totalGrupo; }), d3.max(data, function(d) { return d.totalGrupo; })])
									.range([10, 60]);

									//sets x-axis scale
									var xScale = d3.scale.log()
										.domain([d3.min(data, function(d) { return (d.fem)/(d.total); })-0.001, d3.max(data, function(d) { return (d.fem)/(d.total); })])
										.range([padding, w-padding]);

									//sets y-axis scale
									var yScale = d3.scale.linear()
										.domain([d3.min(data, function(d) { return (d.csup)/(d.total); })-0.02, d3.max(data, function(d) { return (d.csup)/(d.total); })])        //0.145, 0.27
										.range([h-padding, padding]);


									//define eixo x
									var xAxis = d3.svg.axis()
										.scale(xScale)
										.tickFormat(formatAsPercentage)
										.orient("bottom");

									//define eixo y
									var yAxis = d3.svg.axis()
										.scale(yScale)
										.tickFormat(formatAsPercentage)
										.orient("left");

										//constroi o eixo x
										chart.append("g")
										.attr("class", "axis") //Assign "axis" class
										.attr("transform", "translate(0," + (h - padding) + ")")
										.call(xAxis);

										// Add the text label for the x axis
								    chart.append("text")
								        .attr("transform", "translate(" + (w/ 2) + "," + (h) + ")")
								        .style("text-anchor", "middle")
								        .text("candidatos do Gênero Feminino/Total candidatos (%)");

										//Create Y axis
										chart.append("g")
										.attr("class", "axis")
										.attr("transform", "translate(" + padding + ",0)")
										.call(yAxis);

										// Add the text label for the Y axis
								    chart.append("text")
								        .attr("transform", "rotate(-90)")
								        .attr("y", 120 - padding)
								        .attr("x",0 - (h / 2))
								        .attr("dy", "1em")
								        .style("text-anchor", "middle")
								        .text("candidatos com curso superior completo/Total de candidatos (%)");

								chart.selectAll("circle")
									.data(dataset)
									.transition()
									.duration(2000)
									//definindo propriedades dos circulos
									.attr("cx", function(d) {
										return xScale((d.fem)/(d.total));
									})
									.attr("cy", function(d) {
										return yScale((d.csup)/(d.total));
									})
									.attr("r", function(d) {
										return rScale(d.totalGrupo);
									})
									.attr("fill", function(d){
										return d.skin;
									});

								//adicionando rotulos
								chart.selectAll("text")
									.data(dataset)
									.transition()
									.duration(2000)
									.text(function(d) {
										return d.cor;
									})
									.attr("x", function(d) {
										return xScale((d.fem)/(d.total))
									})
									.attr("y", function(d) {
										return yScale((d.csup)/(d.total));
									})
									.attr("text-anchor", "middle")
									.attr("font-family", "sans-serif")
									.attr("font-size", "11px")
									.attr("fill", "white");

								chart.selectAll("circle")
									.data(dataset)
									.append("title")
										.text(function(d) {
											return "Cor:" +"\t"+"\t"+"\t" + d.cor + "\n"
											+ "Total:" +"\t"+"\t"+"\t" + d.total + "\n"
											+ "% Feminino:" +"\t"+"\t"+d.fem + "\n"
											+ "% Curso sup.completo:" +"\t"+ d.csup;
										});

	/*
									$("circle").mouseover(function(){
									    $("p").css("background-color", "yellow");
									});
	*/
								}
						});
					});


				}

		</script>
	</head>
	<body>

		<h1>Visualização 2: Distribuição do Perfil Social - por Cor de Pele</h1>
		<h2>Clique sobre um dos anos abaixo:</h2>
		<p id="year">2014_</p>
		<p id="year">2018_</p>

		<svg class="chart">
			<circle cx="50" cy="50" r="20" fill="#003366" />
			<circle cx="50" cy="50" r="20" fill="#003366" />
			<circle cx="50" cy="50" r="20" fill="#003366" />
      <circle cx="50" cy="50" r="20" fill= "#003366" />
			<circle cx="50" cy="50" r="20" fill="#003366" />
			<text x="50" y="50" fill="white"></text>
			<text x="50" y="50" fill="white"></text>
			<text x="50" y="50" fill="white"></text>
			<text x="50" y="50" fill="white"></text>
			<text x="50" y="50" fill="white"></text>

      <div class="legend">
			Legenda:
  			<div class="square" id="amarela"></div>Amarela
  			<div class="square"id="branca"></div>Branca
  			<div class="square"id="indigena"></div>Indígena
  			<div class="square"id="parda"></div>Parda
  			<div class="square"id="negra"></div>Negra
  		</div>

	 </svg>

		<script type="text/javascript">

		//definindo os dados
		var dataset;
		drawSkin();


//		}

		</script>

	</body>
	<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
</html>
